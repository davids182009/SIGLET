// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.24/esri/copyright.txt for details.
//>>built
define("esri/dijit/analysis/utils","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/event dojo/_base/fx dojo/_base/json dojo/dom-attr dojo/has dojo/i18n dojo/io-query dojo/i18n!../../nls/jsapi dojo/json dojo/string dojo/query dojo/date/locale dojo/dom-style dojo/dom-class dojo/dom-construct dojo/Deferred dojo/promise/all dojo/fx/easing dojo/number dojo/_base/window dojo/when dojo/dom dojo/on dojo/data/ItemFileWriteStore dojo/topic dojox/mvc/equals dijit/registry dijit/Dialog dijit/form/CheckBox ../../kernel ../../lang ../../units ../../request ./HelpWindow ../../tasks/query ../../dijit/BrowseItems ../../layers/FeatureLayer ./PluginAnalysisLayers ../../tasks/Geoprocessor ../../dijit/SingleFilter ./FeatureRecordSetLayer ./PluginLayers ./PCSList ./ItemTypes ../../layers/ArcGISImageServiceLayer ../../layers/RasterFunction ./AnalysisRegistry".split(" "),
function(A,k,n,ka,T,I,U,F,V,la,W,r,B,m,z,J,u,X,t,w,Y,K,C,Z,G,L,M,aa,ma,ba,ca,da,N,ea,l,h,H,fa,ga,ha,D,na,O,oa,ia,pa,P,v,Q,ja,x){A={};k.mixin(A,{_helpDialog:null,i18n:null,UNITSMAP:{Feet:"esriFeet",Yards:"esriYards",Miles:"esriMiles",Meters:"esriMeters",Kilometers:"esriKilometers",NauticalMiles:"esriNauticalMiles"},initHelpLinks:function(a,b,c){if(a){var d=ca.byNode(a),e=d?d.get("helpFileName"):c&&c.helpFileName?c.helpFileName:null,f=d?d.get("isSingleTenant"):c&&c.isSingleTenant?c.isSingleTenant:!1,
g=x.Modes.standard,y=d&&d.portalSelf?d.portalSelf.helpBase:c&&c.helpBase?c.helpBase:null;this._helpDialog||(this._helpDialog=new fa({isPortal:f}));d&&(d.showGeoAnalyticsParams||d.showBigData)||c&&c.analysisMode&&c.analysisMode===x.Modes.Bigdata?(e+="_bd",g=x.Modes.Bigdata):c&&c.analysisMode&&"raster"===c.analysisMode&&(e+="_ra",g=x.Modes.Raster);z("[esriHelpTopic]",a).forEach(function(d,p,h){d&&(u.set(d,"display",l.isDefined(b)&&!0!==b?"none":""),l.isDefined(d._helpClickHandler)&&(d._helpClickHandler.remove(),
d._helpClickHandler=null),d._helpClickHandler=M(d,"click",k.hitch(this,function(b){T.stop(b);c&&c.showHelpFromUrl&&c.helpUrl?this._helpDialog.show(b,{showHelpFromUrl:c.showHelpFromUrl,helpUrl:c.helpUrl}):this._helpDialog.show(b,{helpId:F.get(d,"esriHelpTopic"),helpFileName:e,analysisGpServer:c&&c.analysisGpServer?c.analysisGpServer:null,helpParentNode:a,isPortal:f,analysisMode:g,helpBase:y})})))},this)}},constructAnalysisFeatColl:function(a){var b={},c;b.featureCollection=a.layerDefinition;for(c in b.featureCollection)b.featureCollection.hasOwnProperty(c)&&
"objectIdField"===c&&(b.featureCollection.objectIdFieldName=k.clone(b.featureCollection.objectIdField),delete b.featureCollection.objectIdField);b.featureCollection.features=a.featureSet.features;return b},constructAnalysisInputLyrObj:function(a,b,c){var d={},e,f,g;l.isDefined(c)||(c=!0);a.getMap?f=a.getMap():a._map&&(f=a._map);if(a.url&&!a._collection)d={url:a.url},e=this.isHostedService(a.url),g=10.2<=a.version&&a._useStandardizedQueries,a.getDefinitionExpression&&a.getDefinitionExpression()?d.filter=
a.getDefinitionExpression():l.isDefined(a.definitionExpression)&&""!==a.definitionExpression&&(d.filter=a.definitionExpression),a.useMapTime&&a.timeInfo&&f&&f.timeExtent&&(g||e||10.2<=a.version)&&c&&(c="",a.timeInfo.startTimeField&&!a.timeInfo.endTimeField?(f.timeExtent.startTime&&(c=a.timeInfo.startTimeField+" \x3e "+(e?"":"timestamp ")+"'"+this.formatDate(f.timeExtent.startTime)+"'"),f.timeExtent.endTime&&(f.timeExtent.startTime&&(c+=" AND "),c+=a.timeInfo.startTimeField+" \x3c "+(e?"":"timestamp ")+
"'"+this.formatDate(f.timeExtent.endTime)+"'")):!a.timeInfo.startTimeField&&a.timeInfo.endTimeField?(f.timeExtent.startTime&&(c=a.timeInfo.endTimeField+" \x3e "+(e?"":"timestamp ")+"'"+this.formatDate(f.timeExtent.startTime)+"'"),f.timeExtent.endTime&&(f.timeExtent.startTime&&(c+=" AND "),c+=a.timeInfo.endTimeField+" \x3c "+(e?"":"timestamp ")+"'"+this.formatDate(f.timeExtent.endTime)+"'")):a.timeInfo.startTimeField&&a.timeInfo.endTimeField&&(f.timeExtent.startTime&&(c=a.timeInfo.startTimeField+" \x3e "+
(e?"":"timestamp ")+"'"+this.formatDate(f.timeExtent.startTime)+"'"),f.timeExtent.endTime&&(f.timeExtent.startTime&&(c+=" AND "),c+=a.timeInfo.endTimeField+" \x3c "+(e?"":"timestamp ")+"'"+this.formatDate(f.timeExtent.endTime)+"'")),d.filter=d.filter?d.filter+(" AND "+c):c),a.credential&&(d.serviceToken=a.credential.token),-1!==d.url.indexOf("?")&&(e=d.url.substring(d.url.indexOf("?")+1,d.url.length),e=W.queryToObject(e),k.mixin(d,e),d.url=d.url.substring(0,d.url.indexOf("?")));else if(!a.url||a._collection)try{d=
a.toJson()}catch(y){a._json=B.parse(a._json),d=a.toJson()}d.name=a.name;b&&(d=new ia(d));return d},formatDate:function(a){return J.format(a,{datePattern:"yyyy-MM-dd",selector:"date"})+" "+J.format(a,{selector:"time",timePattern:"HH:mm:ss"})},isHostedService:function(a){if(!a)return!1;var b=-1!==a.indexOf(".arcgis.com/");a=-1!==a.indexOf("//services")||-1!==a.indexOf("//tiles")||-1!==a.indexOf("//features");return b&&a},isPortalHostedService:function(a){return a?-1!==a.toLowerCase().indexOf("/hosted/"):
!1},isTimeEnabled:function(a){var b=10.2<=a.version&&a._useStandardizedQueries;return a.useMapTime&&a.timeInfo&&(b||10.2<=a.version)||l.isDefined(a.time)},isTimeInstantLayer:function(a){return l.isDefined(a.timeInfo)&&l.isDefined(a.timeInfo.startTimeField)&&!l.isDefined(a.timeInfo.endTimeField)||l.isDefined(a.time)&&l.isDefined(a.time.timeType)&&"instant"===a.time.timeType},buildReport:function(a,b){var c="";b||(b={},k.mixin(b,r.analysisMsgCodes));n.forEach(a,function(a,e){var d,g,y;"string"===typeof a.message?
(d=l.isDefined(b[a.messageCode])?b[a.messageCode]:a.message,c+=a.style.substring(0,a.style.indexOf("\x3c/"))+(this._isEmptyObject(a.params)?d:m.substitute(d,a.params))+a.style.substring(a.style.indexOf("\x3c/"))):k.isArray(a.message)&&(y=[],g=k.clone(a.style),n.forEach(a.message,function(c,e){g=g.replace(/<\//,"${"+e+"}");d=l.isDefined(b[a.messageCode+"_"+e])?b[a.messageCode+"_"+e]:c;d=this._isEmptyObject(a.params)?d:m.substitute(d,a.params);y.push(d+"\x3c/")},this),g=m.substitute(g,y),c+=g)},this);
return c},getLayerFeatureCount:function(a,b){var c=new ga;c.geometry=b.geometry||"";c.where=b.where||"1\x3d1";c.geometryType=b.geometryType||"esriGeometryEnvelope";a.getDefinitionExpression&&a.getDefinitionExpression()&&!b.where?c.where=a.getDefinitionExpression():l.isDefined(a.definitionExpression)&&""!==a.definitionExpression&&!b.where&&(c.where=a.definitionExpression);return a.queryCount(c)},createPolygonFeatureCollection:function(a){var b;b={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPolygon"}};
b.layerDefinition={currentVersion:10.2,copyrightText:"",defaultVisibility:!0,relationships:[],isDataVersioned:!1,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,geometryType:"esriGeometryPolygon",minScale:0,maxScale:0,objectIdField:"OBJECTID",templates:[],type:"Feature Layer",displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",allowGeometryUpdates:!0,htmlPopupType:"",hasM:!1,hasZ:!1,globalIdField:"",
supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:-1,indexes:[],types:[],drawingInfo:{renderer:{type:"simple",symbol:{color:[0,0,0,255],outline:{color:[0,0,0,255],width:3,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSNull"},label:"",description:""},transparency:0,labelingInfo:null,fixedSymbols:!0},fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",
name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return b},createPointFeatureCollection:function(a){var b;b={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPoint"}};b.layerDefinition={objectIdField:"OBJECTID",templates:[],type:"Feature Layer",drawingInfo:{renderer:{field1:"TYPEID",type:"simple",symbol:{height:24,
xoffset:0,yoffset:12,width:24,contentType:"image/png",type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/GreenStickpin.png"},description:"",value:"0",label:"Stickpin"}},displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",types:[],geometryType:"esriGeometryPoint",fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",
name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return b},createFolderStore:function(a,b){var c=new aa({data:{identifier:"id",label:"name",items:[]}});c.newItem({name:b,id:""});n.forEach(a,function(a){c.newItem({name:a.title,id:a.id})});return c},setupFoldersUI:function(a){a.folderSelect.set("store",a.folderStore);a.folderSelect.set("required",
!0);a.folderSelect.set("searchAttr","name");l.isDefined(a.folderId)?a.folderStore.get(a.folderId).then(k.hitch(this,function(b){l.isDefined(b)?a.folderSelect.set("item",b):a.folderStore.get("").then(function(b){a.folderSelect.set("item",b)},this)})):a.folderName?a.folderStore.fetch({query:{name:a.folderName},onComplete:k.hitch(this,function(b){l.isDefined(b)&&0<b.length?a.folderSelect.set("item",b[0]):a.folderStore.get("").then(function(b){a.folderSelect.set("item",b)},this)})}):a.username?a.folderSelect.set("displayedValue",
a.username):a.folderStore.get("").then(function(b){a.folderSelect.set("item",b)},this)},_isEmptyObject:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},validateServiceName:function(a,b){var c=/(:|&|<|>|%|#|\?|\\|\"|\/|\+)/.test(a),d=!0,e,f;l.isDefined(b)&&b.textInput&&(f=b.textInput);this.initI18n();if(0===a.length||0===m.trim(a).length)e=this.i18n.requiredValue,d=!1;else if(c)e=this.i18n.invalidServiceName,d=!1;else if(98<a.length)e=this.i18n.invalidServiceNameLength,d=!1;else if(170<
encodeURIComponent(a).length){for(c=a+"";170<encodeURIComponent(c).length;)c=c.substring(0,c.length-1);e=m.substitute(this.i18n.suggestedServiceNameLength,{count:c.length});d=!1}f&&!d&&f.set("invalidMessage",e);return d},getStepNumber:function(a){z(".esriAnalysisNumberLabel",a).forEach(function(a,c){var b=this._getNumberLabel(c);F.set(a,"innerHTML",b)},this)},_getNumberLabel:function(a){var b="";this.initI18n();switch(a){case 0:b=this.i18n.oneLabel;break;case 1:b=this.i18n.twoLabel;break;case 2:b=
this.i18n.threeLabel;break;case 3:b=this.i18n.fourLabel;break;case 4:b=this.i18n.fiveLabel;break;case 5:b=this.i18n.sixLabel;break;case 6:b=this.i18n.sevenLabel;break;case 7:b=this.i18n.eightLabel;break;case 8:b=this.i18n.nineLabel}return b},populateAnalysisLayers:function(a,b,c,d){if(a){var e=[],f=a.get(b);b=a._analysisSelect||d.layerSelect;a.rerun&&!f&&(d||(d={}),d.chooseBlank=!0);a._titleRow&&u.set(a._titleRow,"display","none");a._analysisLabelRow&&u.set(a._analysisLabelRow,"display","table-row");
a._selectAnalysisRow&&(u.set(a._selectAnalysisRow,"display","table-row"),X.add(a._analysisSelect.domNode,"esriTrailingMargin3"),u.set(a._analysisSelect.domNode.parentNode,"padding-bottom","1em"));a.domNode&&this.getStepNumber(a.domNode);l.isDefined(d)&&d.chooseLabel&&e.push({value:-1,label:this.i18n.chooseLabel});l.isDefined(d)&&d.chooseBlank&&e.push({value:"  ",label:""});l.isDefined(d)&&l.isDefined(d.posIncrement)||(l.isDefined(d)||(d={}),d.posIncrement=0);a.get(c)||a.set(c,[]);n.forEach(a.get(c),
function(a,b){b+=d.posIncrement;var c={value:l.isDefined(d)&&d.chooseLabel?""+b+1:""+b,label:a.name};f&&(a.name===f.name||a.url&&f.url&&a.url===f.url)&&(c.selected=!0);e.push(c)},this);b.addOption(e);b.set("required",!0);d.chooseBlank&&"  "===b.get("value")&&setTimeout(k.hitch(this,this._validateSelectUI,b),100)}},isValidAnalysisLayer:function(a){var b,c,d,e,f,g,k,q="",p=!0;b={isValid:p,validationMessage:q};var h,R,E=0,S=0,t=0,r,u,v,w=!0;if(!l.isDefined(a)||!l.isDefined(a.toolName))return b;this.initI18n();
b=a.toolName;c=a.layers;d=a.analysisLayer;e=b.charAt(0).toLowerCase()+b.substring(1);k=this.i18n;a=a.showReadyToUseLayers||!1;n.forEach(c,function(a){w=!1;a instanceof Q&&(r=!0);r&&1<a.bandCount&&(u=!0);r&&1===a.bandCount&&(v=!0);"esriGeometryPoint"===a.geometryType&&(g=!0,E++);if("esriGeometryPoint"===a.geometryType||"esriGeometryMultipoint"===a.geometryType)h=!0;"esriGeometryPolyline"===a.geometryType&&(R=!0,t++);"esriGeometryPolygon"===a.geometryType&&(f=!0,S++)},this);-1!==n.indexOf(["CreateDriveTimeAreas",
"PlanRoutes","ConnectOriginsToDestinations"],b)&&(!g||d&&"esriGeometryPoint"!==d.geometryType)?(q=m.substitute(this.i18n.selectPointLayer,{toolName:k[e]}),p=!1):"AggregatePoints"!==b&&"InterpolatePoints"!==b||(!d||"esriGeometryPoint"===d.geometryType||"esriGeometryMultipoint"===d.geometryType)&&h?"CalculateDensity"===b&&(!h&&!R||d&&"esriGeometryPoint"!==d.geometryType&&"esriGeometryMultipoint"!==d.geometryType&&"esriGeometryPolyline"!==d.geometryType)?(q=m.substitute(this.i18n.areaFeatureInvalidMsg,
{toolName:k[e]}),p=!1):"FindHotSpots"===b&&(!h&&!f||d&&"esriGeometryPoint"!==d.geometryType&&"esriGeometryMultipoint"!==d.geometryType&&"esriGeometryPolygon"!==d.geometryType)?(q=m.substitute(this.i18n.hotspotsLineFeatureMsg,{toolName:k[e]}),p=!1):"OverlayLayers"!==b&&"AggregatePoints"!==b&&"SummarizeWithin"!==b&&"SummarizeNearby"!==b&&"FindNearest"!==b&&"MergeLayers"!==b||a||0!==c.length&&(1!==c.length||c[0]!==d&&l.isDefined(d))?"ConnectOriginsToDestinations"===b&&!a&&(w||2>E)?(q=m.substitute(this.i18n.odPointMsg,
{toolName:k[e]}),p=!1):this.isFindCentroids(b)&&this.isPointLayer(d)?(q=m.substitute(this.i18n.selectNoPointLayer,{toolName:k[e]}),p=!1):this.isToolRequiresPointLayer(b)&&0===E?(q=m.substitute(this.i18n.selectPointLayer,{toolName:k[e]}),p=!1):"AggregatePoints"===b&&!a&&1<c.length?(f=n.some(c,function(a){return"esriGeometryPolygon"===a.geometryType}),f||(q=m.substitute(this.i18n.aggregatePolyMsg,{toolName:k[e]}),p=!1)):"MergeLayers"===b&&!a&&1<c.length?1<E||1<t||1<S||(q=this.i18n.mergeValidationMsg,
p=!1):"SummarizeWithin"!==b&&"DissolveBoundaries"!==b||(!d||"esriGeometryPolygon"===d.geometryType)&&f||a?"ExtractData"===b?(p=n.some(c,function(a){return-1!==a.capabilities.indexOf("Extract")}))||(q=m.substitute(this.i18n.extractValidationMsg)):("ConnectOriginsToDestinations"===b||b===x.Tools.ChooseBestFacilities)&&1<c.length?(g=n.some(c,function(a){var b=l.isDefined(d)&&d.id===a.id;return"esriGeometryPoint"===a.geometryType&&!b}),g||(q=m.substitute(b===x.Tools.ChooseBestFacilities?this.i18n.selectPointLayer:
this.i18n.odPointMsg,{toolName:k[e]}),p=!1)):"CalculateSlope"===b||"DeriveAspect"===b||"RemapValues"===b?r?v||(p=!1,q=m.substitute(this.i18n.noSingleBandISMsg,{toolName:k[e]})):(p=!1,q=m.substitute(this.i18n.noImageServiceMsg,{toolName:k[e]})):"ExtractRaster"===b?r||(p=!1,q=m.substitute(this.i18n.noImageServiceMsg,{toolName:k[e]})):"MonitorVegetation"===b&&(r?u||(p=!1,q=m.substitute(this.i18n.noMultiBandISMsg,{toolName:k[e]})):(p=!1,q=m.substitute(this.i18n.noImageServiceMsg,{toolName:k[e]}))):(q=
m.substitute(this.i18n.selectPolyLayer,{toolName:k[e]}),p=!1):(q=m.substitute(this.i18n.overlayValidationMsg,{toolName:k[e]}),p=!1):(q=m.substitute(this.i18n.selectPointLayer,{toolName:k[e]}),p=!1);return b={isValid:p,validationMessage:q}},isToolRequiresPointLayer:function(a){return a===x.Tools.ChooseBestFacilities},isFindCentroids:function(a){return a===x.Tools.FindCentroids},isPointLayer:function(a){return a&&"esriGeometryPoint"===a.geometryType},initI18n:function(){this.i18n||(this.i18n={},k.mixin(this.i18n,
r.common),k.mixin(this.i18n,r.analysisTools),k.mixin(this.i18n,r.analysisMsgCodes),k.mixin(this.i18n,r.browseLayersDlg),k.mixin(this.i18n,r.driveTimes),k.mixin(this.i18n,r.calculateFields))},addBrowseAnalysisDialog:function(a){if(a&&a.widget){this.i18n||this.initI18n();var b="esri/dijit/analysis/PluginAnalysisLayers",c=function(a){return"\x3cimg class\x3d'grid-item galleryThumbnail' width\x3d'120px' height\x3d'80px' alt\x3d'' src\x3d'"+(a.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png")+
"'\x3e"},d=function(a){return'\x3cdiv class\x3d"galleryLabelContainer"\x3e\x3cspan alt\x3d\''+(a.title||a.name||"\x3cNo Title\x3e")+"'\x3e"+(a.title.replace(/_/g," ")||a.name.replace(/_/g," ")||"\x3cNo Title\x3e")+"\x3c/span\x3e\x3c/div\x3e"},e=function(a){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'16px' height\x3d'16px' alt\x3d'' src\x3d'"+a.iconUrl+"'/\x3e"},f=function(a){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'16px' height\x3d'16px' alt\x3d'' src\x3d'"+a.iconUrl+"'/\x3e"},
g=Z.doc.createDocumentFragment(),g=t.create("div",{style:"width:100%;height:100%;"},g),h=t.create("div",{style:"width:100%;height:10%;","class":""}),q=t.create("div",{style:"width:100%"},g),p,l,m,n=this._isCustomAnalysisQuery(a.widget);1===a.browseType?(b="esri/dijit/analysis/PluginLayers",b={portalUrl:a.widget.get("portalUrl"),message:"",plugin:b,sortDescending:!0,sort:"title",self:a.widget.get("portalSelf"),itemsPerPage:100,demandList:!0,extent:a.widget.get("map").extent,useExtent:!1,fetchTimeout:600,
galleryTemplate:"\x3cdiv class\x3d'listServiceTitle'\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%'\x3e\x3ctd nowrap\x3d'nowrap'\x3e  \x3cdiv  style\x3d\"position:absolute;left:80px; top:10px; width:1px; height:1px; background: transparent;\"\x3e\x3c/div\x3e\x3cdiv style\x3d'overflow:hidden;'\x3e\x3ca style\x3d\"height:16px;\"\x3e${item.title}\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%' class\x3d'bottomRowTable'\x3e\x3ctd width\x3d'20'\x3e  \x3cspan class\x3d'esriAlignLeading'\x3e${item:_formatThumbnail}\x3c/span\x3e\x3c/td\x3e\x3ctd nowrap\x3d'nowrap'\x3e  \x3cspan class\x3d'esriAlignLeading' style\x3d'color:#656565;'\x3e${item.owner}\x3c/span\x3e\x3c/td\x3e\x3ctd style\x3d'padding-right:5px;padding-left:3px;'\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e",
showInfoPanel:!0,isAutoClose:!1,checkIsButtonEnabled:!0,formatThumbnail:f,formatInfoPanelImage:e,"class":"esriAnalysisLayersItems"}):b={portalUrl:a.widget.get("portalUrl"),message:"",plugin:b,sortDescending:!0,sort:"title",self:a.widget.get("portalSelf"),pagingLinks:1,rowsPerPage:6,"class":"esriBrowseAnalysisLayers itemsGallery esriFloatLeading",extent:a.widget.get("map").extent,useExtent:!n,fetchTimeout:600,galleryTemplate:'\x3cdiv style\x3d\'opacity:1;\' class\x3d\'grid-item gallery-view galleryNode\'\x3e${item:_formatItemTitle}${item:_formatThumbnail}\x3cdiv class\x3d"linksDiv" style\x3d\'display:none;\'\x3e\x3cdiv class\x3d"esriItemLinks"\x3e\x3cdiv class\x3d"esriFloatLeading"\x3e\x3ca style\x3d"text-decoration: none;"\x3e\x3cspan\x3eAdd layer to analysis\x3c/span\x3e\x3cdiv class\x3d"dijitReset dijitInline esriArrows"\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
formatItemTitle:d,showInfoPanel:!1,showTooltip:!0,formatThumbnail:c,style:"width:48em;height:100%;clear:both;"};d=t.toDom('\x3cdiv class\x3d"esriBrowseOptions"\x3e');t.place(d,h);c=t.create("div",{"class":"esriBrowseOption"},d);a.browseType&&1===a.browseType||(d=t.create("div",{"class":"esriBrowseOption"},d),l=new N({name:"addlayer",id:a.widget.id+(a.browseType?a.browseType:"")+"_addlayercheck","class":"",value:!1,checked:!1},t.create("input",{},d)),t.create("label",{"for":a.widget.id+"_addlayercheck",
"class":"esriBrowseOption_label",innerHTML:this.i18n.addLayer},d));d=!0;a.browseType&&1===a.browseType?d=!1:n&&(d=!1);d=new N({name:"extentcheck",id:a.widget.id+(a.browseType?a.browseType:"")+"_addextentcheck","class":"",value:d,checked:d},t.create("input",{},c));t.create("label",{"for":a.widget.id+(a.browseType?a.browseType:"")+"_addextentcheck","class":"esriBrowseOption_label",innerHTML:this.i18n.withinMapArea},c);b.messageRight=h;p=new ha(b,q);d.on("change",k.hitch(this,function(a){p.set("useExtent",
a)}));m=new da({title:1===a.browseType?this.i18n.browseLayers:n?this.i18n.browseAnalysisLayers:this.i18n.browseAnalysisTitle,content:g,browseItems:p,addlayerCheckBox:l,style:a.browseType&&1===a.browseType?"":"padding:.75em 0;background-color: #fff;width:50em;"});a.widget.own(a.widget.get("map").on("extent-change",k.hitch(a.widget,function(b){p.set("extent",a.widget.get("map").extent)})),m.on("hide",k.hitch(m,function(a){m.browseItems.reset()})));return m}},addAnalysisReadyLayer:function(a){function b(b){var c,
e,f;"Feature Service"===d.type&&(f=new D(d.url,{outFields:["*"]}),k.mixin(d,f));k.mixin(d,b);d.id=d.title+"_"+b.id;d.title=a.item.selectedLayer?d.title+"-"+b.name:d.title.replace(/_/g," ");d.name=d.title;d.version=d.currentVersion;c=a.layersSelect.getOptions();if(a.widget.showBrowseLayers&&a.widget.showReadyToUseLayers)e=3;else if(a.widget.showBrowseLayers||a.widget.showReadyToUseLayers)e=2;c=c.splice(c.length-e,e);a.layersSelect.removeOption(c);e=a.layers.length;a.posIncrement&&(e+=a.posIncrement);
e=""+e;c.unshift({value:e,label:d.title,selected:!0});a.layersSelect.addOption(c);a.layersSelect.set("value",e);f&&(d.lyr=f,f.name=d.name);d.linfo=b;a.layers.push(d);var g;z(".js-add-layer-checkbox",a.browseDialog.browseItems.infoPanel).forEach(function(a){g=a.checked});if(a.browseDialog.addlayerCheckBox&&a.browseDialog.addlayerCheckBox.get("checked")||g)this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=a.widget.map.on("layer-add",k.hitch(this,function(c){this._addLayerHandle.remove();
a.widget.emit("add-ready-to-use-layer",{layer:c.layer,layerInfo:b,item:d})})),a.widget.map.addLayer(f);a.browseDialog.browseItems.clear()}if(l.isDefined(a)&&l.isDefined(a.item)&&l.isDefined(a.layersSelect)&&l.isDefined(a.layers)&&l.isDefined(a.browseDialog)){a.browseDialog.hide();var c,d,e,f,g,h;(c=!a.item.selectedLayer&&a.item.url?a.item.url+"/0":a.item.selectedLayer.url)&&-1!==window.location.protocol.indexOf("https:")&&(c=c.replace("http:","https:"));d={url:c,itemId:a.item.id,title:a.item.title,
type:a.item.type,analysisReady:!0};c=n.some(a.layers,function(b,c){var f=b.analysisReady&&d.analysisReady&&b.itemId===d.itemId;a.item.selectedLayer&&a.item.selectedLayer.url&&(f=b.itemId===d.itemId&&b.url===d.url);f&&(e=c);return f});f=new w;h="sync";if(c){a.posIncrement&&(e+=a.posIncrement);var q;z(".js-add-layer-checkbox",a.browseDialog.browseItems.infoPanel).forEach(function(a){q=a.checked});if(a.browseDialog.addlayerCheckBox&&a.browseDialog.addlayerCheckBox.get("checked")||q)a.posIncrement||(a.posIncrement=
0),g=a.layers[e-a.posIncrement],a.widget.map.getLayer(g.lyr.id)||(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=a.widget.map.on("layer-add",k.hitch(this,function(b){this._addLayerHandle.remove();a.widget.emit("add-ready-to-use-layer",{layer:b.layer,layerInfo:g.linfo,item:g})})),a.widget.map.addLayer(g.lyr));a.layersSelect.set("value",""+e);a.browseDialog.browseItems.clear();f.resolve()}else a.item.selectedLayer?(d.url=a.item.selectedLayer.url,f.then(k.hitch(this,b)),setTimeout(function(){f.resolve(a.item.selectedLayer)},
500)):(h=a.item.itemDataUrl?H({url:a.item.itemDataUrl,content:{f:"json"}}):"sync",G(h,k.hitch(this,function(a){a&&a.layers&&a.layers[0].id&&(d.url=d.url.substring(0,d.url.lastIndexOf("/0"))+"/"+a.layers[0].id);H({url:d.url,content:{f:"json"}}).then(k.hitch(this,function(a){b(a);f.resolve()}))})));return f.promise}},addReadyToUseLayerOption:function(a,b){a&&(a.showReadyToUseLayers||a.showBrowseLayers)&&(b||(b=[]),a.signInPromise||(a.signInPromise=new w,setTimeout(k.hitch(this,function(){a.signInPromise.resolve()}),
100)),a.i18n||(this.initI18n(),a.i18n=this.i18n),a.signInPromise.then(k.hitch(this,function(){n.forEach(b,function(b){var c=b.getOptions();n.some(c,function(a){return"separator"===a.type},this)||!a.showReadyToUseLayers&&!a.showBrowseLayers||b.addOption({type:"separator",value:""});a.showReadyToUseLayers&&(c=a.i18n.browseAnalysisTitle,this._isCustomAnalysisQuery(a)&&(c=a.i18n.browseAnalysisLayers),b.addOption({value:"browse",label:c}));a.showBrowseLayers&&b.addOption({value:"browselayers",label:a.i18n.browseLayers})},
this);a.showReadyToUseLayers&&!l.isDefined(a._browsedlg)&&(a._browsedlg=this.addBrowseAnalysisDialog({widget:a}),a.own(a._browsedlg.browseItems.on("select-change",k.hitch(a,a._handleBrowseItemsSelect)),a._browsedlg.on("hide",k.hitch(a,function(){n.forEach(b,function(a){"browse"===a.get("value")&&a.reset()});a.layersSelect&&a.layersSelect.reset()}))));a.showBrowseLayers&&!l.isDefined(a._browseLyrsdlg)&&(a._browseLyrsdlg=this.addBrowseAnalysisDialog({widget:a,browseType:1}),a.own(a._browseLyrsdlg.on("browseitems-close",
k.hitch(this,function(b){"add-layer"===b.action&&(a._browseLyrsdlg.browseItems.plugIn._grid&&(b.selection.selectedLayer=a._browseLyrsdlg.browseItems.plugIn._selectedLayer,a._handleBrowseItemsSelect({dialog:a._browseLyrsdlg,selection:b.selection})),a._browseLyrsdlg.browseItems.closeInfoPanel())})),a._browseLyrsdlg.on("hide",k.hitch(a,function(){n.forEach(b,function(a){"browselayers"===a.get("value")&&a.reset()})}))))})))},_isCustomAnalysisQuery:function(a){var b='title:"Living Atlas Analysis Layers" AND owner:esri',
c=!1;a&&a.isSingleTenant&&(b='title:"Living Atlas Analysis Layers" AND owner:esri_livingatlas');a.portalSelf&&a.portalSelf.analysisLayersGroupQuery&&a.portalSelf.analysisLayersGroupQuery!==b?c=!0:a._portal&&a._portal.analysisLayersGroupQuery&&a._portal.analysisLayersGroupQuery!==b&&(c=!0);return c},getMaxInputByMode:function(a){var b;if(a&&a.units&&a.type){if("StraightLine"===a.type)"Miles"===a.units?b=1E3:"Yards"===a.units?b=176E4:"Kilometers"===a.units?b=C.format(1609.34,{places:2}):"Meters"===
a.units?b=C.format(1609340,{places:2}):"Feet"===a.units&&(b=528E4);else if("DrivingDistance"===a.type||"TruckingDistance"===a.type||"WalkingDistance"===a.type)"Miles"===a.units?b=300:"Yards"===a.units?b=528E3:"Kilometers"===a.units?b=C.format(482.802,{places:2}):"Meters"===a.units?b=C.format(482802,{places:2}):"Feet"===a.units&&(b=1584E3);else if("DrivingTime"===a.type||"TruckingTime"===a.type||"WalkingTime"===a.type)"Minutes"===a.units?b=300:"Seconds"===a.units?b=18E3:"Hours"===a.units&&(b=5);return b}},
updateModeConstraints:function(a){var b;a&&a.validateWidget&&a.units&&a.type&&(b=a.validateWidget.get("constraints"),b.max=this.getMaxInputByMode(a),a.validateWidget.set(b))},getTravelModes:function(a){var b=new w,c,d,e,f;l.isDefined(this.travelModes)&&0<this.travelModes.length?b.resolve(this.travelModes):a&&a.widget?a.widget.signInPromise.then(k.hitch(this,function(g){(f=a.widget.get("helperServices"))&&f.routingUtilities?(e=f.routingUtilities.url,c="sync"):c=a.widget._getSelf(a.widget.portalUrl);
G(c,k.hitch(this,function(a){a&&a.helperServices&&a.helperServices.routingUtilities&&(e=a.helperServices.routingUtilities.url);l.isDefined(e)?(d=new O(e+"/GetTravelModes"),d.execute({}).then(k.hitch(this,function(a){this.travelModes=n.map(a[0].value&&a[0].value.features,function(a){return U.fromJson(a.attributes.TravelMode)});a[1]&&a[1].paramName&&"defaultTravelMode"===a[1].paramName&&(this.defaultTravelModeId=a[1].value);b.resolve(this.travelModes)}),k.hitch(this,function(a){b.reject(a)}))):b.reject(Error("Missing Routing Utility Service to get Travel Modes"))}),
function(a){b.reject(a)})})):b.reject(Error("Missing parameter: params.widget required parameter"));return b.promise},populateTravelModes:function(a){if(a&&a.selectWidget&&a.widget){var b=[],c=a.allowmode||"all",d=!1;this.initI18n();a.addStraightLine&&b.push({value:"StraightLine",label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esriStraightLineDistanceIcon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+this.i18n.straightLineDistance+"\x3c/div\x3e",
selected:a.value&&"StraightLine"===a.value});this.getTravelModes({widget:a.widget}).then(k.hitch(this,function(e){var f=l.isDefined(a.enableTravelModes)&&!a.enableTravelModes;n.forEach(e,function(e,k){var g=this.createOptionForTravelMode(e,{name:e.name,disabled:f,separator:a.separator});this.isTravelModeAllowed(c,g.units)&&("all"!==c&&(g.value=g.value.replace(g.units,"")),a.value&&a.value.id===e.id?ba(a.value,e)&&(d=g.selected=!0):!a.value&&a.selectDefaultMode&&this.defaultTravelModeId&&this.defaultTravelModeId===
e.id&&(g.selected=!0),b.push(g))},this);!d&&this.isRequiredToAddTravelMode(a)&&this.isTravelModeAllowed(c,this.getTravelModeUnits(a.value))&&b.push(this.getOptionForCustomTravelMode(a,f));a.selectWidget.removeOption();a.selectWidget.addOption(b);a.widget.emit("travelmodes-added",{travelOptions:b})}),k.hitch(this,function(c){b&&0<b.length&&(a.selectWidget.removeOption(),a.selectWidget.addOption(b),a.widget.emit("travelmodes-added",{travelOptions:b}))}))}},getTravelModeLabel:function(a,b){var c=b?b:
a.name;return'\x3cdiv class\x3d"esriFloatLeading bufferIcon esri'+this.getTravelModei18nKey(a.type)+this.getTravelModeUnits(a)+'Icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;" title\x3d"'+a.description+'"\x3e'+c+"\x3c/div\x3e"},getTravelModeUnits:function(a){var b=a.units||name.split(/\s/)[1];return b=a.impedanceAttributeName===a.timeAttributeName?"Time":a.impedanceAttributeName===a.distanceAttributeName?"Distance":"Other"},getTravelModeValue:function(a,
b){return a.replace(/\s/g,b||"")},getTravelModei18nKey:function(a){return"AUTOMOBILE"===a?"Driving":"TRUCK"===a?"Trucking":"WALK"===a?"Walking":"Other"},isTravelModeAllowed:function(a,b){return"all"===a||a.toLowerCase()===b.toLowerCase()},isRequiredToAddTravelMode:function(a){return a.widget.rerun&&"StraightLine"!==a.value},getOptionForCustomTravelMode:function(a,b){var c=this.createOptionForTravelMode(a.value,{name:"\x26lt"+a.value.name+"\x26gt",disabled:b,separator:a.separator});c.selected=!0;return c},
createOptionForTravelMode:function(a,b){return{label:this.getTravelModeLabel(a,b.name),value:this.getTravelModeValue(b.name,b.separator),travelMode:a,disabled:b.disabled,modei18nKey:this.getTravelModei18nKey(a.type).toLowerCase(),units:this.getTravelModeUnits(a)}},updateDisplay:function(a,b,c){(new z.NodeList(a)).style("display",b?c?c:"block":"none")},isGreaterThanZero:function(){return 0<this.get("value")},getExprFunctions:function(){this.i18n||this.initI18n();this.exprFunctions||(this.exprFunctions=
[{type:"NumType",label:m.substitute(this.i18n.asMetersFunc,{functionName:"as_meters(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_meters()"},{type:"NumType",label:m.substitute(this.i18n.asKilometersFunc,{functionName:"as_kilometers(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_kilometers()"},{type:"NumType",label:m.substitute(this.i18n.asFeetFunc,{functionName:"as_feet(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_feet()"},
{type:"NumType",label:m.substitute(this.i18n.asYardsFunc,{functionName:"as_yards(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_yards()"},{type:"NumType",label:m.substitute(this.i18n.asMilesFunc,{functionName:"as_miles(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_miles()"},{type:"NumType",label:m.substitute(this.i18n.asNuaticalMilesFunc,{functionName:"as_nautical_miles(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_nautical_miles()"},
{type:"NumType",label:m.substitute(this.i18n.absFunc,{functionName:"abs(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"abs()"},{type:"NumType",label:m.substitute(this.i18n.logFunc,{functionName:"log(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"log()"},{type:"NumType",label:m.substitute(this.i18n.sinFunc,{functionName:"sin(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"sin()"},{type:"NumType",label:m.substitute(this.i18n.cosFunc,{functionName:"cos(\x3ci\x3enumber\x3c/i\x3e)",
num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"cos()"},{type:"NumType",label:m.substitute(this.i18n.tanFunc,{functionName:"tan(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"tan()"},{type:"NumType",label:m.substitute(this.i18n.squareRootFunc,{functionName:"sqrt(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"sqrt()"},{type:"NumType",label:m.substitute(this.i18n.minFunc,{functionName:"min(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"min()"},
{type:"NumType",label:m.substitute(this.i18n.maxFunc,{functionName:"max(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"max()"},{type:"NumType",label:m.substitute(this.i18n.constrainFunc,{functionName:"constrain(\x3ci\x3enumber\x3c/i\x3e, \x3ci\x3elow\x3c/i\x3e, \x3ci\x3ehigh\x3c/i\x3e",num:"\x3ci\x3enumber\x3c/i\x3e",low:"\x3ci\x3elow\x3c/i\x3e",high:"\x3ci\x3ehigh\x3c/i\x3e"}),name:"constrain(,,)"},{type:"NumType",label:m.substitute(this.i18n.iffFunc,{functionName:"iif(\x3ci\x3econdition\x3c/i\x3e,\x3ci\x3evalue if TRUE\x3c/i\x3e,\x3ci\x3evalue if FALSE\x3c/i\x3e)",
num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"iif(,,)"},{type:"NumType",label:m.substitute(this.i18n.whenFunc,{functionName:"when(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"when(,)"},{type:"NumType",label:m.substitute(this.i18n.decodeFunc,{functionName:"decode(\x3ci\x3eexpression\x3c/i\x3e, \x3ci\x3ecase1,return1,..caseN,returnN\x3c/i\x3e, \x3ci\x3edefault\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"decode(,,,)"}]);return this.exprFunctions},addAttributeOptions:function(a){this.initI18n();
l.isDefined(a.allowSelectLabel)||(a.allowSelectLabel=!0);var b,c,d,e=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"];b=a.layer;c=a.selectWidget;d=b?b.fields:[];c.removeOption(c.getOptions());a.allowSelectLabel&&c.addOption({value:"",label:this.i18n.attribute});a.allowStringType&&e.push("esriFieldTypeString");var f=[];n.forEach(d,function(a){-1!==n.indexOf(e,a.type)&&a.name!==b.objectIdField&&f.push({value:a.name,label:l.isDefined(a.alias)&&""!==a.alias?
a.alias:a.name,type:"esriFieldTypeString"===a.type?"string":"number"})},this);c.addOption(f);c.set("value","0");c.set("disabled",!b||0===b.fields.length)},addStatisticsOptions:function(a){this.initI18n();var b=a.selectWidget,c=[{value:"SUM",label:this.i18n.sum},{value:"MIN",label:this.i18n.minimum},{value:"MAX",label:this.i18n.maximum},{value:"MEAN",label:a.showGeoAnalyticsParams?this.i18n.mean:this.i18n.average},{value:"STDDEV",label:this.i18n.standardDev}];b.removeOption(b.getOptions());b.addOption([{value:"0",
label:this.i18n.statistic}]);a.showGeoAnalyticsParams&&(b.addOption({value:"COUNT",label:this.i18n.count}),c.push({value:"VARIANCE",label:this.i18n.variance}),c.splice(4,0,{value:"RANGE",label:this.i18n.range}));a.type&&"number"!==a.type?a.type&&"string"===a.type&&b.addOption({value:"ANY",label:this.i18n.any}):b.addOption(c);b.set("value","0")},addFillOptions:function(a){var b=a.selectWidget,c=[{value:"ZEROES",label:this.i18n.zeroes},{value:"SPATIAL_NEIGHBORS",label:this.i18n.spatialneighbhors},{value:"SPACE_TIME_NEIGHBORS",
label:this.i18n.spacetimeneighbors},{value:"TEMPORAL_TREND",label:this.i18n.temporaltrend}];b.removeOption(b.getOptions());b.addOption([{value:"0",label:this.i18n.fill}]);a.type&&"number"!==a.type||b.addOption(c)},perMeter:function(a){var b=1;switch(a){case h.MILLIMETERS:b=1E3;break;case h.CENTIMETERS:b=100;break;case h.DECIMETERS:b=10;break;case h.METERS:b=1;break;case h.KILOMETERS:b=.001;break;case h.INCHES:b=39.370079;break;case h.FEET:b=3.2808399;break;case h.YARDS:b=1.0936133;break;case h.MILES:b=
6.2137119E-4;break;case h.NAUTICAL_MILES:b=5.399568E-4;break;case h.ACRES:b=2.4710538E-4;break;case h.ARES:b=.01;break;case h.HECTARES:b=1E-4;break;case h.SQUARE_INCHES:b=1550.0031;break;case h.SQUARE_FEET:b=10.7639104;break;case h.SQUARE_YARDS:b=1.19599005;break;case h.SQUARE_MILES:b=3.86102159E-7;break;case h.SQUARE_NAUTICAL_MILES:b=2.9155335E-7;break;case h.SQUARE_MILLIMETERS:b=1E6;break;case h.SQUARE_CENTIMETERS:b=1E4;break;case h.SQUARE_DECIMETERS:b=100;break;case h.SQUARE_METERS:b=1;break;case h.SQUARE_KILOMETERS:b=
1E-6}return b},getType:function(a){var b=null;switch(a){case h.ACRES:b=2;break;case h.ARES:b=2;break;case h.CENTIMETERS:b=1;break;case h.DECIMETERS:b=1;break;case h.FEET:b=1;break;case h.HECTARES:b=2;break;case h.INCHES:b=1;break;case h.KILOMETERS:b=1;break;case h.METERS:b=1;break;case h.MILES:b=1;break;case h.MILLIMETERS:b=1;break;case h.NAUTICAL_MILES:b=1;break;case h.SQUARE_CENTIMETERS:b=2;break;case h.SQUARE_DECIMETERS:b=2;break;case h.SQUARE_FEET:b=2;break;case h.SQUARE_INCHES:b=2;break;case h.SQUARE_KILOMETERS:b=
2;break;case h.SQUARE_METERS:b=2;break;case h.SQUARE_MILES:b=2;break;case h.SQUARE_MILLIMETERS:b=2;break;case h.SQUARE_NAUTICAL_MILES:b=2;break;case h.SQUARE_YARDS:b=2;break;case h.YARDS:b=1;break;default:b=0}return b},unitConversion:function(a,b,c){var d=!0;l.isDefined(a)||(this.emitError("The 'From' Value must be a valid numeric value: "+a),d=!1);l.isDefined(b)||(this.emitError("The 'From' Units must be defined: "+b),d=!1);l.isDefined(c)||(this.emitError("The 'To' Units must be defined: "+c),d=
!1);a instanceof Array&&(this.emitError("Only single 'From' Value supported: "+a),d=!1);b instanceof Array&&(this.emitError("Only single 'From' Units supported: "+b),d=!1);c instanceof Array&&(this.emitError("Only single 'To' Units supported: "+c),d=!1);var e=this.getType(b),f=this.getType(c);0===e&&(this.emitError("Unsupported 'From' Units: "+b),d=!1);0===f&&(this.emitError("Unsupported 'To' Units: "+c),d=!1);e!==f&&(this.emitError("Incompatible 'From' and 'To' Units: "+b+" and "+c),d=!1);return d?
b===c?+a:+a/this.perMeter(b)*this.perMeter(c):Number.NaN},emitError:function(a){console.log("error",Error(a))},isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return B.stringify(a)===B.stringify({})},getNetworkAnalysisLimits:function(a){var b={},c=new w,d,e,f,g;a||c.reject(Error("Missing parameter: widget required parameter"));-1!==n.indexOf(["CreateDriveTimeAreas","EnrichLayer","SummarizeNearby"],a.toolName)?k.mixin(b,{toolName:"GenerateServiceAreas",serviceName:"asyncServiceArea"}):
a.toolName===x.Tools.ChooseBestFacilities?k.mixin(b,{toolName:"SolveLocationAllocation",serviceName:"asyncLocationAllocation"}):"PlanRoutes"===a.toolName?k.mixin(b,{toolName:"SolveVehicleRoutingProblem",serviceName:"asyncVRP"}):"FindNearest"===a.toolName?k.mixin(b,{toolName:"FindClosestFacilities",serviceName:"asyncClosestFacility"}):"ConnectOriginsToDestinations"===a.toolName&&k.mixin(b,{toolName:"FindRoutes",serviceName:"asyncRoute"});this.NALimits||(this.NALimits=[]);this.NALimits&&this.NALimits[b.toolName]?
c.resolve(this.NALimits[b.toolName]):a.signInPromise.then(k.hitch(this,function(h){(g=a.get("helperServices"))&&g.routingUtilities?(f=g.routingUtilities.url,d="sync"):d=a._getSelf(a.portalUrl);G(d,k.hitch(this,function(a){a&&a.helperServices&&a.helperServices.routingUtilities&&(f=a.helperServices.routingUtilities.url);l.isDefined(f)||c.reject(Error("Missing Routing Utility Service to get Network Analysis Service Limits."));e=new O(f+"/GetToolInfo");e.execute(b).then(k.hitch(this,function(a){a&&0<
a.length&&a[0].value&&a[0].value.serviceLimits?(this.NALimits[b.toolName]=a[0].value.serviceLimits,c.resolve(this.NALimits[b.toolName])):c.reject("Routing Utility Service 'GetToolInfo' job did not return service limits.")}),function(a){c.reject(a)})}))}),function(a){c.reject(a)});return c.promise},isEsriWorldGeocoder:function(a){var b=this.isAgoWorldGeocodeServer(a);a=this.isAgoWorldGeocodeServerProxy(a);return b||a},isAgoWorldGeocodeServer:function(a){return a&&!!a.match(/(arcgis.com\/arcgis\/rest\/services\/world\/geocodeserver).*/ig)},
isAgoWorldGeocodeServerProxy:function(a){return a&&!!a.match(/(\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/ig)},isWorldGeoLocator:function(a){return a&&!!a.match(/(\/rest\/services\/world\/geocodeserver).*/ig)},showMessages:function(a,b,c){F.set(b,"innerHTML",a);I.fadeIn({node:c,easing:K.quadIn,onEnd:k.hitch(this,function(){u.set(c,{display:""})})}).play()},hideMessages:function(a){I.fadeOut({node:a,easing:K.quadOut,onEnd:function(){u.set(a,{display:"none"})}}).play()},getHelpUrl:function(a){if(a.topic&&
a.widget){var b;a.widget.portalSelf&&a.widget.portalSelf.helpBase?b=a.widget.portalSelf.helpBase+"index.html#":!a.widget.isSingleTenant||a.widget.portalSelf&&a.widget.portalSelf.helpBase||(b="http://server.arcgis.com/en/portal/latest/use/");"BufferExpression"===a.topic&&(b+="Use_expressions_with_GeoAnalytics_Tools/019300000183000000/");return b}},isPCS:function(a){return!!a&&!!P&&-1!==n.indexOf(P,a)},isPCSByLayerType:function(a){var b=!!a&&!!a.fullExtent&&this.isPCS(a.fullExtent.spatialReference.wkid);
!b&&a.extent&&(b=!!a&&!!a.extent&&this.isPCS(a.extent.spatialReference.wkid));!b&&a.spatialReference&&(b=!!a&&!!a.spatialReference&&this.isPCS(a.spatialReference.wkid));return b},checkPCSforAnalysis:function(a){var b=a.widget&&a.widget.toolName,c=!!a.widget&&!!a.widget.context&&!!a.widget.context.processSR&&this.isPCS(a.widget.context.processSR.wkid),d=!0,e=a.jobParams||a.widget.jobParams,f,g,h=!!a.widget&&!!a.widget.context&&!!a.widget.context.processSR&&!!a.widget.context.processSR.wkid;if(!b||
!e||!a.widget.showGeoAnalyticsParams)return!1;g="\x3ca  href\x3d'#' id\x3d'"+a.widget.id+"_warn_settings_link'\x3e"+a.widget.i18n.analysisSettings+"\x3c/a\x3e\x3cdiv class\x3d'esriAnalysisSettingsIcon'\x3e\x3c/div\x3e";f=m.substitute(a.widget.i18n.PCSReqMsg,{defaultSpatialRef:a.widget.i18n.worldCylindrical,settingsIcon:g});"FindHotSpots"!==b||c?"CalculateDensity"!==b||c?"AggregatePoints"!==b||-1===n.indexOf(["HEXAGON","SQUARE"],e.binType)||c?"SummarizeWithin"===b&&e.summaryPolygons&&!c?d=this.isPCSByLayerType(a.widget.sumWithinLayer):
"SummarizeWithin"!==b||-1===n.indexOf(["HEXAGON","SQUARE"],e.binType)||c?"JoinFeatures"===b&&e.spatialNearDistance&&!c&&((d=this.isPCSByLayerType(a.widget.targetLayer))||(f=m.substitute(a.widget.i18n.JFPCSReqMsg,{settingsIcon:g}))):d=this.isPCSByLayerType(a.widget.summaryLayer):d=this.isPCSByLayerType(a.widget.pointLayer):d=this.isPCSByLayerType(a.widget.inputLayer):d=this.isPCSByLayerType(a.widget.analysisLayer);d||a.hasPCSWarnShown||(a.widget.set("disableRunAnalysis",d),this.settingsVM&&this.settingsDlg&&
a.widget._bodyNode&&a.widget._errorMessagePane&&(this.showMessages(f,a.widget._bodyNode,a.widget._errorMessagePane),L.byId(a.widget.id+"_warn_settings_link")&&M(L.byId(a.widget.id+"_warn_settings_link"),"click",k.hitch(a.widget,a.widget.showSettingsDlg))));!d&&a.hasPCSWarnShown&&h&&(d=!0);return d},tryParseJSON:function(a){try{var b=B.parse(a);if(b&&"object"===typeof b&&null!==b)return b}catch(c){}return!1},decodeTag:function(a){return{"\x26lt;":"\x3c","\x26gt;":"\x3e"}[a]||a},stringDecode:function(a){return a.replace(/(&lt;|&gt;)/g,
this.decodeTag)},jobParamsToWidgetProps:function(a){if(a&&a.jobParams){var b=a.jobParams,c=new w,d=[],e=[],f;for(f in b){var g;b.hasOwnProperty(f)&&("string"===typeof b[f]&&-1!==b[f].search(/(&lt;|&gt;)/g)&&(b[f]=this.stringDecode(b[f])),g="string"===typeof b[f]?this.tryParseJSON(b[f]):b[f])&&(-1!==f.toLowerCase().indexOf("layer")&&"object"===typeof g?e.push({key:f,obj:g}):g&&(g.Raster||g.url)&&e.push({key:f,obj:g}),b[f]=g)}for(f=0;f<e.length;f++){g=e[f].obj;var h=e[f].key;"object"===typeof g&&g.length?
(b[h]=[],n.forEach(g,function(a,c){this._getFlayers(a,h,b,d,!0,c)},this)):"object"===typeof g&&g.Raster?(g.url=g.Raster.url,this._getFlayers(g,h,b,d,!0,"Raster")):this._getFlayers(g,h,b,d)}Y(d).then(k.hitch(this,function(){c.resolve(a)}),k.hitch(this,function(){c.resolve(a)}));return c.promise}},_getLayerType:function(a){return a?-1!==a.indexOf("BigDataCatalogServer")?v.BIGDATA:-1!==a.indexOf("ImageServer")?v.IS:v.FS:null},_getFlayers:function(a,b,c,d,e,f){var g,h;a.url?(g=H({url:a.url,content:{f:"json"}}),
h=new w,d.push(h),g.then(k.hitch(this,function(a,b,d,f,h){var g,l=this._getLayerType(a.url);l===v.FS?(g=new D(a.url,{mode:D.MODE_ONDEMAND,outFields:["*"],resourceInfo:h}),a.filter&&g.setDefinitionExpression(a.filter),g.filter=a.filter):l===v.BIGDATA?(g=h,k.mixin(g,a)):l===v.IS&&(h=a.Raster||a,g=new Q(h.url),h.renderingRule&&g.setRenderingRule(new ja(h.renderingRule)),h.name&&(g.name=h.name),a.Raster&&a.Raster.url===a.url&&delete a.url);a.name&&(g.name=a.name);e?c[b][f]=g:e&&l===v.IS?k.mixin(c[b][f],
g):c[b]=g;d.resolve()},a,b,h,f),k.hitch(this,function(a,b,d,f,g){a={name:a.name,empty:!0};e?c[b][f]=a:c[b]=a;d.resolve()},a,b,h,f))):(d=new D(a,{outFields:["*"]}),a.name&&(d.name=a.name),e?c[b][f]=d:c[b]=d)},isLayerInLayers:function(a,b){return n.some(b,function(b){return b.name===a.name||b.url&&a.url&&b.url===a.url})},addBlankOption:function(a,b){b&&b.length?b.push({value:"  ",label:""}):a.addOption({value:"  ",label:""});setTimeout(k.hitch(this,this._validateSelectUI,a),100)},_validateSelectUI:function(a){a._hasBeenBlurred=
!0;a.set("focused",!0);a.validate();a.set("focused",!1);a._hasBeenBlurred=!1;setTimeout(k.hitch(this,function(){a.reset()}),1E3)},updateExpressions:function(a){a&&a.selectedInputLayers&&a.inputLayers&&a.data&&a.expressions&&(n.forEach(a.selectedInputLayers,function(b,c){n.forEach(a.inputLayers,function(a,e){a&&b&&(b.name===a.name||b.url===a.url)&&(b._oldIndex=c,b._newIndex=e)})}),n.forEach(a.data,function(b,c){var d;0<c&&b&&(d=a.expressions[c-1],l.isDefined(b.layer)&&(b.layer=d&&d.layer),l.isDefined(b.selectingLayer)&&
(b.selectingLayer=d&&d.selectingLayer))}),n.forEach(a.data,function(b){var c=!1,d=!1;n.forEach(a.selectedInputLayers,function(a){l.isDefined(b.layer)&&b.layer===a._oldIndex&&!c&&(b.layer=a._newIndex,c=!0);l.isDefined(b.selectingLayer)&&b.selectingLayer===a._oldIndex&&!d&&(b.selectingLayer=a._newIndex,d=!0)},this)},this))},isBigDataTypeTobeAdded:function(a){return-1==n.indexOf(a,'type:"Big Data File Share"')?!0:!1}});V("extend-esri")&&k.setObject("dijit.analysis.utils",A,ea);return A});