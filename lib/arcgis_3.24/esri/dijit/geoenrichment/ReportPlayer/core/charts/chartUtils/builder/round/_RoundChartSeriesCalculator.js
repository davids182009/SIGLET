// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.24/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/chartUtils/builder/round/_RoundChartSeriesCalculator","../../ThemeCalculator ../../ChartTypes ../../ChartSorting ../../../../supportClasses/conditionalStyling/ConditionalStyleUtil ../../../../supportClasses/templateJsonUtils/fieldInfo/FieldInfoBuilder ../utils/ChartDataUtil ../utils/TooltipInfoBuilder ../utils/ChartDataLabelBuilder dojo/i18n!../../../../../../../../nls/jsapi".split(" "),function(D,g,w,x,E,y,F,G,k){k=k.geoenrichment.dijit.ReportPlayer.ChartContainer;
return{calcSeries:function(a){var z=a.seriesItems,f=a.chartType,H=a.themeSettings,I=a.viewModel,d=a.visualProperties,J=a.previewFeatureIndex,n=a.sorting;a=[];var p=z[0],q={name:"data",data:[]},l=[],r=0,t=0,u=1E6,v=-1E6,A,e=p.points;f===g.GAUGE&&1===e.length&&(e=e.slice(),e.push({label:k.gaugeOthers}));if(g.isConditionalStylingEnabled(f)&&d.conditionalStyling){var B=x.getStatistics(d.conditionalStyling);B&&p&&(A=y.getChartData(B,e.length))}var C=E.isFieldInfoInPercentState(e[0].fieldInfo),m=[];e.forEach(function(a,
c){var b;f===g.GAUGE&&1===c?(b=l[0],b=C?Math.max(0,100-b):d.gaugeRangeMax?Math.max(0,d.gaugeRangeMax-(d.gaugeRangeMin||0)-b):0):(b=y.getPreviewValue(a,c,0,!1,f,d,I,J,A),f===g.GAUGE&&0===c&&(m[c]=b,C||(d.gaugeRangeMax&&(b=Math.min(b,d.gaugeRangeMax)),b-=d.gaugeRangeMin||0)));l[c]=b;b=void 0!==m[c]?m[c]:b||0;r+=b;t+=Math.abs(b);u=Math.min(u,b);v=Math.max(v,b)});f===g.GAUGE&&0===l[1]&&(e.length=1);var K=r/e.length;e.forEach(function(a,c){var b=l[c],e=b||0,h;g.isConditionalStylingEnabled(f)&&d.conditionalStyling&&
(h=(h=x.getConditionalStyle(e,d.conditionalStyling))&&h.backgroundColor);h=h||D.calcColorForPoint(a,p,c,0,z.length,f,H);var k=b;f===g.GAUGE&&0===c&&(k=m[c]);q.data.push({originalValue:b,x:1,y:Math.max(1E-4,e),isUnavailableData:isNaN(b),valueProp:"y",unsortedIndex:c,name:a.label,point:a,fill:h,text:G.formatDataLabel(e,a.label,t,d,f),tooltip:F.getTooltipInfo(k,a.label,null,u,v,r,t,K,d,f,h,d.conditionalStyling,a.fieldInfo),stroke:{width:0}})});g.isSortingEnabled(f)&&n&&n!==w.NONE&&q.data.sort(function(a,
c){return(a.y-c.y)*(n===w.DESC?-1:1)});a.push(q);return a}}});