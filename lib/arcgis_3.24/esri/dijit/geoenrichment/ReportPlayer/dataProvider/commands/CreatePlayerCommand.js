// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.24/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/commands/CreatePlayerCommand","dojo/_base/declare dojo/promise/all dojo/when dijit/Dialog ./createHTML/HTMLStringBuilder esri/dijit/geoenrichment/utils/FileUtil ./supportClasses/MapToImageUtil ../../PlayerCommands ../supportClasses/GEUtil dojo/i18n!../../../../../nls/jsapi ../../_devConfig".split(" "),function(l,u,d,m,n,h,p,q,r,c,f){c=c.geoenrichment.dijit.ReportPlayer.ReportPlayer;var t={buildHTMLPageString:function(a,b,d){a=b.config.createPlayerCommand.prettifyDataJson||
f.createPlayerCommand.saveDataJsonAsTextFile?JSON.stringify(a,void 0,4):JSON.stringify(a);f.createPlayerCommand.saveDataJsonAsTextFile&&h.saveTextFile(a,"reportDataJson");var c=[];c.push('html, body, #layoutNode { padding: 0px; margin: 0px; height: 100%; overflow: hidden; font-size: 13px; font-family: "Avenir Next"; }');return n.composeHtmlStringFromParts({reportTitle:b.getReportTitle(),links:[b.config.esriDijitCssUrl,b.config.esriCssUrl],cssFiles:c,scripts:[{src:b.config.playerSourceRootUrl},'require(["require", "esri/dijit/geoenrichment/nlsFix"],\nfunction (relativeRequire, nlsFix) {\n   nlsFix.load(null, relativeRequire);\n   require([\n       "dojo/when",\n       "dojo/sniff",\n       "esri/dijit/geoenrichment/ReportPlayer/ReportPlayer",\n       "esri/dijit/geoenrichment/ReportPlayer/DataProviderGE",\n       "esri/dijit/geoenrichment/ReportPlayer/PlayerResizeModes",\n       "esri/dijit/geoenrichment/ReportPlayer/PlayerZoomBehaviors",\n       "esri/dijit/geoenrichment/ReportPlayer/PlayerCommands",\n       "esri/dijit/geoenrichment/utils/UrlUtil",\n       "dojo/domReady!"\n   ],\n   function (\n       when,\n       has,\n       ReportPlayer,\n       DataProviderGE,\n       PlayerResizeModes,\n       PlayerZoomBehaviors,\n       PlayerCommands,\n       UrlUtil\n   ) {\n       esriConfig.defaults.io.proxyUrl \x3d UrlUtil.getVariableValue(window.location.href, "proxy") || null;\n       var reportDataJson \x3d '+
a+';\n       var dataProvider \x3d new DataProviderGE();\n       dataProvider.registerCommand(PlayerCommands.PRINT);\n       if (!has("ie") \x26\x26 !has("trident"))\n       dataProvider.registerCommand(PlayerCommands.IMAGE);\n       var player \x3d new ReportPlayer({\n           isSlidesView: UrlUtil.getVariableValue(window.location.href, "slidesView"),\n           dataProvider: dataProvider,\n           enableDataDrilling: '+d+",\n           resizeMode: PlayerResizeModes.FIT_WINDOW,\n           defaultZoomBehavior: PlayerZoomBehaviors.FIT_PAGE,\n           onError: function(e) {\n               console.log(e);\n           }\n       }).placeAt(layoutNode);\n       when(dataProvider.reportDataFromJson(reportDataJson), function (reportData) {\n           player.setReportData(reportData);\n       });\n   });\n});"],
contentString:'\x3cdiv id\x3d"layoutNode"\x3e\x3c/div\x3e'})}};return l(null,{id:q.DYNAMIC_HTML,label:c.createDynamicHTMLCommandLabel,errorMessage:c.exportInfographicError,execute:function(a,b){function c(c){var d=t.buildHTMLPageString(c,a,k);g=d;var e=a.getReportTitle()+".html";return d&&!b.returnAsHtmlText&&f._confirmSaveFile(e,function(){h.saveTextFile(d,e,"text/html")})}b=b||{};var f=this,e=b.printableContainer,k=e.allowDataDrilling(),g;return d(p.collectMapsAsImages(a,{saveImagesAsBase64:!0}),
function(e){return d(a.dataProvider.reportDataToJson(a.getReportData(),{allowDataDrilling:k,mapImageInfos:e}),function(e){if(b.returnReportDataJson)g=e;else return d(c(e),function(){b.creditsTaskID&&r.consumeCredits(a.getReportData().config.geoenrichmentUrl,b.creditsTaskID)})})}).otherwise(this._handleError.bind(this)).always(function(){return d(e.stop(),function(){return g})})},_handleError:function(a){console.log(a);(new m({title:"Error",content:this.errorMessage})).show()},_confirmSaveFile:function(a,
b){return b()}})});